<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ruscord загрузка</title>
  <style>
    body {
      margin: 0;
      background: #121212;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #fff;
      font-family: sans-serif;
    }
    img {
      width: 100px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    #status {
      margin-top: 20px;
      font-size: 14px;
    }
    #bar-container {
      margin-top: 10px;
      width: 80%;
      height: 4px;
      background: #444;
      border-radius: 2px;
      overflow: hidden;
    }
    #bar {
      height: 100%;
      background: #262626;
      width: 0;
    }
  </style>
</head>
<body>
  <img src="../../Images/icon2.png" alt="Ruscord">
  <div id="status">Подготовка...</div>
  <div id="bar-container"><div id="bar"></div></div>

  <script>
    const status = document.getElementById('status');
    const bar = document.getElementById('bar');

    function updateConnectionStatus() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString();
      status.textContent = `Попытка подключения ${timeStr}`;
      window.electronAPI.checkConnection().then(isOnline => {
        if (isOnline) {
          status.textContent = 'Подключаемся';
        } else {
          setTimeout(updateConnectionStatus, 2000);
        }
      });
    }

    updateConnectionStatus();

    window.electronAPI.onUpdateAvailable(version => {
      status.textContent = `Доступно обновление: ${version}`;
    });

    window.electronAPI.onUpdateProgress(data => {
      const { percent, transferred, total } = data;
      bar.style.width = `${percent}%`;
      const format = (bytes) => {
        if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(1) + ' ГБ';
        if (bytes >= 1048576) return (bytes / 1048576).toFixed(1) + ' МБ';
        if (bytes >= 1024) return (bytes / 1024).toFixed(1) + ' КБ';
        return bytes + ' Б';
      };
      status.textContent = `Скачано ${format(transferred)} из ${format(total)}`;
    });

    window.electronAPI.onUpdateDownloaded(() => {
      status.textContent = 'Обновление загружено. Ждём подтверждения...';
    });

    window.electronAPI.onUpdateError(msg => {
      status.textContent = `Ошибка обновления: ${msg}`;
    });
  </script>
</body>
</html>
